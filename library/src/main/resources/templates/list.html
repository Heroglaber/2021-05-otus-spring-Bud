<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Library</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>

<div id="wrapper">
    <div id="header">
        <h2>List of all books</h2>
    </div>
</div>

<div id="container">

    <div id="content">

        <input type="button" value="Add book"
               onclick="window.location.href='addBook'; return false;"
               class="btn btn-primary"
        />

        <table class="table table-striped">
            <thead>
            <tr>
                <th scope="col"> id </th>
                <th scope="col"> title </th>
                <th scope="col"> authors </th>
                <th scope="col"> genres </th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${books.isEmpty()}">
                <td colspan="2"> No Books Available </td>
            </tr>
            <tr th:each="book : ${books}">
                <div th:object="${book}">
                    <td><span th:text="*{id}"> id </span></td>
                    <td><span th:text="*{title}"> title </span></td>
                    <td>
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th scope="col"> id </th>
                                    <th scope="col"> name </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="author : *{authors}">
                                    <div th:object="${author}">
                                        <td th:text="*{id}"> id </td>
                                        <td th:text="*{name}"> name </td>
                                    </div>
                                </tr>
                                </tbody>
                            </table>
                    </td>
                    <td>
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th scope="col"> id </th>
                                <th scope="col"> name </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="genre : *{genres}">
                                <div th:object="${genre}">
                                    <td th:text="*{id}"> id </td>
                                    <td th:text="*{name}"> name </td>
                                </div>
                            </tr>
                            </tbody>
                        </table>
                    </td>
                    <td><a name="editBook" class="btn btn-primary" th:href="@{/edit/{id}(id = *{id})}">Edit</a>
                        | <button type="button" class="btn btn-primary" name="deleteBook" th:with="deleteLink = @{/delete/{id}(id = *{id})}"
                             th:onclick="sendDelete([[${deleteLink}]])">Delete</button>
                        <br>
                        <a name="viewÐ¡omments mt-3" class="btn btn-primary" th:href="@{/comments/{id}(id = *{id})}">View comments</a>
                    </td>
                </div>
            </tr>
            </tbody>
        </table>

    </div>

</div>

<script th:inline="javascript">
    function sendDelete(url) {
        if(!(confirm('Are you sure you want to delete this book?'))) return false;
        var xhttp = new XMLHttpRequest();
        xhttp.open("DELETE", url, true);
        xhttp.onload = function () {
            let responseURL = xhttp.responseURL;
            console.log("Redirecting to:", responseURL);
            window.location.replace(responseURL);
        };
        xhttp.send();
    }
</script>

</body>
</html>
